\hypertarget{parallel__for_8hpp_source}{}\doxysection{parallel\+\_\+for.\+hpp}
\label{parallel__for_8hpp_source}\index{/Users/lums/NWmath/NWgr/include/nwgraph/util/parallel\_for.hpp@{/Users/lums/NWmath/NWgr/include/nwgraph/util/parallel\_for.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// }}
\DoxyCodeLine{2 \textcolor{comment}{// This file is part of NW Graph (aka GraphPack) }}
\DoxyCodeLine{3 \textcolor{comment}{// (c) Pacific Northwest National Laboratory 2018-\/2021 }}
\DoxyCodeLine{4 \textcolor{comment}{// (c) University of Washington 2018-\/2021 }}
\DoxyCodeLine{5 \textcolor{comment}{// }}
\DoxyCodeLine{6 \textcolor{comment}{// Licensed under terms of include LICENSE file }}
\DoxyCodeLine{7 \textcolor{comment}{// }}
\DoxyCodeLine{8 \textcolor{comment}{// Authors: }}
\DoxyCodeLine{9 \textcolor{comment}{//     Andrew Lumsdaine }}
\DoxyCodeLine{10 \textcolor{comment}{//}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#ifndef NW\_GRAPH\_PARALLEL\_FOR\_HPP}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#define NW\_GRAPH\_PARALLEL\_FOR\_HPP}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}nwgraph/util/traits.hpp"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <tbb/parallel\_for.h>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <tbb/parallel\_reduce.h>}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{keyword}{namespace }nw \{}
\DoxyCodeLine{20 \textcolor{keyword}{namespace }graph \{}
\DoxyCodeLine{30 \textcolor{keyword}{template} <\textcolor{keyword}{class} Op, \textcolor{keyword}{class} It>}
\DoxyCodeLine{31 \textcolor{keyword}{auto} parallel\_for\_inner(Op\&\& op, It\&\& i) \{}
\DoxyCodeLine{32   \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (is\_tuple\_v<std::decay\_t<It>>) \{}
\DoxyCodeLine{33     \textcolor{keywordflow}{return} std::apply([\&](\textcolor{keyword}{auto}\&\&... args) \{ \textcolor{keywordflow}{return} std::forward<Op>(op)(std::forward<decltype(args)>(args)...); \}, std::forward<It>(i));}
\DoxyCodeLine{34   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (std::is\_integral\_v<std::decay\_t<It>>) \{}
\DoxyCodeLine{35     \textcolor{keywordflow}{return} std::forward<Op>(op)(std::forward<It>(i));}
\DoxyCodeLine{36   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{37     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (is\_tuple\_v<decltype(*std::forward<It>(i))>) \{}
\DoxyCodeLine{38       \textcolor{keywordflow}{return} parallel\_for\_inner(std::forward<Op>(op), *std::forward<It>(i));}
\DoxyCodeLine{39     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{40       \textcolor{keywordflow}{return} std::forward<Op>(op)(*std::forward<It>(i));}
\DoxyCodeLine{41     \}}
\DoxyCodeLine{42   \}}
\DoxyCodeLine{43 \}}
\DoxyCodeLine{44 }
\DoxyCodeLine{52 \textcolor{keyword}{template} <\textcolor{keyword}{class} Range, \textcolor{keyword}{class} Op>}
\DoxyCodeLine{53 \textcolor{keywordtype}{void} parallel\_for\_sequential(Range\&\& range, Op\&\& op) \{}
\DoxyCodeLine{54   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&\&i = range.begin(), e = range.end(); i != e; ++i) \{}
\DoxyCodeLine{55     parallel\_for\_inner(op, i);}
\DoxyCodeLine{56   \}}
\DoxyCodeLine{57 \}}
\DoxyCodeLine{58 }
\DoxyCodeLine{73 \textcolor{keyword}{template} <\textcolor{keyword}{class} Range, \textcolor{keyword}{class} Op, \textcolor{keyword}{class} Reduce, \textcolor{keyword}{class} T>}
\DoxyCodeLine{74 \textcolor{keyword}{auto} parallel\_for\_sequential(Range\&\& range, Op\&\& op, Reduce\&\& reduce, T init) \{}
\DoxyCodeLine{75   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&\&i = range.begin(), e = range.end(); i != e; ++i) \{}
\DoxyCodeLine{76     init = reduce(init, parallel\_for\_inner(op, i));}
\DoxyCodeLine{77   \}}
\DoxyCodeLine{78   \textcolor{keywordflow}{return} init;}
\DoxyCodeLine{79 \}}
\DoxyCodeLine{80 }
\DoxyCodeLine{93 \textcolor{keyword}{template} <\textcolor{keyword}{class} Range, \textcolor{keyword}{class} Op>}
\DoxyCodeLine{94 \textcolor{keywordtype}{void} parallel\_for(Range\&\& range, Op\&\& op) \{}
\DoxyCodeLine{95   \textcolor{keywordflow}{if} (range.is\_divisible()) \{}
\DoxyCodeLine{96     tbb::parallel\_for(std::forward<Range>(range),}
\DoxyCodeLine{97                       [\&](\textcolor{keyword}{auto}\&\& sub) \{ parallel\_for\_sequential(std::forward<\textcolor{keyword}{decltype}(sub)>(sub), std::forward<Op>(op)); \});}
\DoxyCodeLine{98   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{99     parallel\_for\_sequential(std::forward<Range>(range), std::forward<Op>(op));}
\DoxyCodeLine{100   \}}
\DoxyCodeLine{101 \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{121 \textcolor{keyword}{template} <\textcolor{keyword}{class} Range, \textcolor{keyword}{class} Op, \textcolor{keyword}{class} Reduce, \textcolor{keyword}{class} T>}
\DoxyCodeLine{122 \textcolor{keyword}{auto} parallel\_reduce(Range\&\& range, Op\&\& op, Reduce\&\& reduce, T init) \{}
\DoxyCodeLine{123   \textcolor{keywordflow}{if} (range.is\_divisible()) \{}
\DoxyCodeLine{124     \textcolor{keywordflow}{return} tbb::parallel\_reduce(}
\DoxyCodeLine{125         std::forward<Range>(range), init,}
\DoxyCodeLine{126         [\&](\textcolor{keyword}{auto}\&\& sub, \textcolor{keyword}{auto} partial) \{ \textcolor{keywordflow}{return} parallel\_for\_sequential(std::forward<\textcolor{keyword}{decltype}(sub)>(sub), op, reduce, partial); \}, reduce);}
\DoxyCodeLine{127   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{128     \textcolor{keywordflow}{return} parallel\_for\_sequential(std::forward<Range>(range), std::forward<Op>(op), std::forward<Reduce>(reduce), init);}
\DoxyCodeLine{129   \}}
\DoxyCodeLine{130 \}}
\DoxyCodeLine{131 \}    \textcolor{comment}{// namespace graph}}
\DoxyCodeLine{132 \}    \textcolor{comment}{// namespace nw}}
\DoxyCodeLine{133 }
\DoxyCodeLine{134 \textcolor{preprocessor}{\#endif    }\textcolor{comment}{// NW\_GRAPH\_PARALLEL\_FOR\_HPP}}

\end{DoxyCode}
