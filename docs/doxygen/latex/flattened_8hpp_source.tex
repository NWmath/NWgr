\hypertarget{flattened_8hpp_source}{}\doxysection{flattened.\+hpp}
\label{flattened_8hpp_source}\index{/Users/lums/NWmath/NWgr/include/nwgraph/containers/flattened.hpp@{/Users/lums/NWmath/NWgr/include/nwgraph/containers/flattened.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// }}
\DoxyCodeLine{2 \textcolor{comment}{// This file is part of NW Graph (aka GraphPack) }}
\DoxyCodeLine{3 \textcolor{comment}{// (c) Pacific Northwest National Laboratory 2018-\/2021 }}
\DoxyCodeLine{4 \textcolor{comment}{// (c) University of Washington 2018-\/2021 }}
\DoxyCodeLine{5 \textcolor{comment}{// }}
\DoxyCodeLine{6 \textcolor{comment}{// Licensed under terms of include LICENSE file }}
\DoxyCodeLine{7 \textcolor{comment}{// }}
\DoxyCodeLine{8 \textcolor{comment}{// Authors: }}
\DoxyCodeLine{9 \textcolor{comment}{//}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 }
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#ifndef NW\_GRAPH\_FLATTENED\_HPP}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#define NW\_GRAPH\_FLATTENED\_HPP}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{keyword}{template} <\textcolor{keywordtype}{bool} is\_const = \textcolor{keyword}{false}, std::size\_t... Attrs>}
\DoxyCodeLine{19 \textcolor{keyword}{class }my\_flat\_iterator \{}
\DoxyCodeLine{20 \textcolor{keyword}{public}:}
\DoxyCodeLine{21   \textcolor{keyword}{using} difference\_type = std::ptrdiff\_t;}
\DoxyCodeLine{22   \textcolor{keyword}{using} value\_type      = nw::graph::select\_t<std::tuple<index\_t, Attributes...>, 0, 1, (Attrs + 2)...>;}
\DoxyCodeLine{23   \textcolor{keyword}{using} reference       = std::conditional<is\_const, \textcolor{keyword}{const} nw::graph::select\_t<std::tuple<index\_t, \textcolor{keyword}{const} Attributes\&...>, 0, 1, (Attrs + 2)...>,}
\DoxyCodeLine{24                                      nw::graph::select\_t<std::tuple<index\_t, const Attributes\&...>, 0, 1, (Attrs + 2)...>>;}
\DoxyCodeLine{25   \textcolor{keyword}{using} pointer         = std::conditional<is\_const, \textcolor{keyword}{const} nw::graph::select\_t<std::tuple<index\_t, \textcolor{keyword}{const} Attributes*...>, 0, 1, (Attrs + 2)...>,}
\DoxyCodeLine{26                                    nw::graph::select\_t<std::tuple<index\_t, const Attributes*...>, 0, 1, (Attrs + 2)...>>;}
\DoxyCodeLine{27   \textcolor{keyword}{using} iterator\_category = std::random\_access\_iterator\_tag;}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{keyword}{private}:}
\DoxyCodeLine{30 }
\DoxyCodeLine{31   \textcolor{keyword}{using} graph\_to\_be\_indexed\_type =}
\DoxyCodeLine{32       \textcolor{keyword}{typename} std::conditional<is\_const, typename std::vector<index\_t>::const\_iterator, \textcolor{keyword}{typename} std::vector<index\_t>::iterator>::type;}
\DoxyCodeLine{33   \textcolor{keyword}{using} graph\_indices\_type = \textcolor{keyword}{typename} std::conditional<is\_const, \textcolor{keyword}{typename} struct\_of\_arrays<Attributes...>::const\_iterator,}
\DoxyCodeLine{34                                                        \textcolor{keyword}{typename} struct\_of\_arrays<Attributes...>::iterator>::type;}
\DoxyCodeLine{35 }
\DoxyCodeLine{36   graph\_to\_be\_indexed\_type graph\_to\_be\_indexed\_;}
\DoxyCodeLine{37   graph\_indices\_type       graph\_indices\_;}
\DoxyCodeLine{38 }
\DoxyCodeLine{39   index\_t         graph\_source\_;}
\DoxyCodeLine{40   index\_t         graph\_indices\_size\_;}
\DoxyCodeLine{41   index\_t         u\_;    \textcolor{comment}{// the current source vertex id}}
\DoxyCodeLine{42   difference\_type j\_;    \textcolor{comment}{// the current edge}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 \textcolor{keyword}{public}:}
\DoxyCodeLine{45   my\_flat\_iterator(index\_t graph\_source, graph\_to\_be\_indexed\_type graph\_to\_be\_indexed, graph\_indices\_type graph\_indices,}
\DoxyCodeLine{46                    index\_t graph\_indices\_size, index\_t i, difference\_type j)}
\DoxyCodeLine{47       : graph\_source\_(graph\_source), graph\_to\_be\_indexed\_(graph\_to\_be\_indexed), graph\_indices\_(graph\_indices),}
\DoxyCodeLine{48         graph\_indices\_size\_(graph\_indices\_size), u\_(i), j\_(j) \{\}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50   reference operator*() \{ \textcolor{keywordflow}{return} \{u\_, std::get<0>(graph\_.to\_be\_indexed\_)[j\_], std::get<Attrs + 1>(graph\_.to\_be\_indexed\_)[j\_]...\}; \}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52   reference operator[](difference\_type n) \{}
\DoxyCodeLine{53     \textcolor{keywordflow}{return} \{graph\_.source(j\_ + n), std::get<0>(graph\_.to\_be\_indexed\_)[j\_ + n], std::get<Attrs + 1>(graph\_.to\_be\_indexed\_)[j\_]...\};}
\DoxyCodeLine{54   \}}
\DoxyCodeLine{55 }
\DoxyCodeLine{56   my\_flat\_iterator\& operator++() \{}
\DoxyCodeLine{57     \textcolor{keywordflow}{for} (++j\_; j\_ >= graph\_.indices\_[u\_ + 1] \&\& u\_ < graph\_.indices\_.size() -\/ 1; ++u\_)}
\DoxyCodeLine{58       ;}
\DoxyCodeLine{59     \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{60   \}}
\DoxyCodeLine{61 }
\DoxyCodeLine{62   my\_flat\_iterator\& operator-\/-\/() \{}
\DoxyCodeLine{63     \textcolor{keywordflow}{for} (-\/-\/j\_; j\_ < graph\_.indices\_[u\_] \&\& u\_ > 0; -\/-\/u\_)}
\DoxyCodeLine{64       ;}
\DoxyCodeLine{65     \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{66   \}}
\DoxyCodeLine{67 }
\DoxyCodeLine{68   my\_flat\_iterator operator++(\textcolor{keywordtype}{int}) \{}
\DoxyCodeLine{69     my\_flat\_iterator i = *\textcolor{keyword}{this};}
\DoxyCodeLine{70     ++(*this);}
\DoxyCodeLine{71     \textcolor{keywordflow}{return} i;}
\DoxyCodeLine{72   \}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74   my\_flat\_iterator operator-\/-\/(\textcolor{keywordtype}{int}) \{}
\DoxyCodeLine{75     my\_flat\_iterator i = *\textcolor{keyword}{this};}
\DoxyCodeLine{76     ++(*this);}
\DoxyCodeLine{77     \textcolor{keywordflow}{return} i;}
\DoxyCodeLine{78   \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80   my\_flat\_iterator\& operator+=(difference\_type n) \{}
\DoxyCodeLine{81     j\_ += n;}
\DoxyCodeLine{82     u\_ = graph\_.source(j\_);}
\DoxyCodeLine{83     \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{84   \}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86   my\_flat\_iterator\& operator-\/=(difference\_type n) \{}
\DoxyCodeLine{87     j\_ -\/= n;}
\DoxyCodeLine{88     u\_ = graph\_.source(j\_);}
\DoxyCodeLine{89     \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{90   \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92   my\_flat\_iterator operator+(difference\_type n)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \{graph\_, graph\_.source(j\_ + n), j\_ + n\}; \}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94   my\_flat\_iterator operator-\/(difference\_type n)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \{graph\_, graph\_.source(j\_ -\/ n), j\_ -\/ n\}; \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96   difference\_type operator-\/(\textcolor{keyword}{const} my\_flat\_iterator\& b)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} j\_ -\/ b.j\_; \}}
\DoxyCodeLine{97 }
\DoxyCodeLine{98   \textcolor{keywordtype}{bool} operator==(\textcolor{keyword}{const} my\_flat\_iterator\& b)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} j\_ == b.j\_; \}}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{keywordtype}{bool} operator!=(\textcolor{keyword}{const} my\_flat\_iterator\& b)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} j\_ != b.j\_; \}}
\DoxyCodeLine{101 }
\DoxyCodeLine{102   \textcolor{keywordtype}{bool} operator<(\textcolor{keyword}{const} my\_flat\_iterator\& b)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} j\_ < b.j\_; \}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104   \textcolor{keywordtype}{bool} operator>(\textcolor{keyword}{const} my\_flat\_iterator\& b)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} j\_ > b.j\_; \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   \textcolor{keywordtype}{bool} operator<=(\textcolor{keyword}{const} my\_flat\_iterator\& b)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} j\_ <= b.j\_; \}}
\DoxyCodeLine{107 }
\DoxyCodeLine{108   \textcolor{keywordtype}{bool} operator>=(\textcolor{keyword}{const} my\_flat\_iterator\& b)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} j\_ >= b.j\_; \}}
\DoxyCodeLine{109 \};}
\DoxyCodeLine{110 }
\DoxyCodeLine{111 \textcolor{keyword}{template} <std::size\_t... Attrs>}
\DoxyCodeLine{112 \textcolor{keyword}{using} flat\_iterator = my\_flat\_iterator<\textcolor{keyword}{false}, Attrs...>;}
\DoxyCodeLine{113 }
\DoxyCodeLine{114 \textcolor{keyword}{template} <std::size\_t... Attrs>}
\DoxyCodeLine{115 \textcolor{keyword}{using} const\_flat\_iterator = my\_flat\_iterator<\textcolor{keyword}{true}, Attrs...>;}
\DoxyCodeLine{116 }
\DoxyCodeLine{118 \textcolor{keyword}{template} <std::size\_t... Attrs>}
\DoxyCodeLine{119 \textcolor{keyword}{class }flat\_range \{}
\DoxyCodeLine{120   flat\_iterator<Attrs...> begin\_;}
\DoxyCodeLine{121   flat\_iterator<Attrs...> end\_;}
\DoxyCodeLine{122   std::ptrdiff\_t          cutoff\_;}
\DoxyCodeLine{123 }
\DoxyCodeLine{124 \textcolor{keyword}{public}:}
\DoxyCodeLine{125   flat\_range(flat\_iterator<Attrs...> begin, flat\_iterator<Attrs...> end, std::ptrdiff\_t cutoff) : begin\_(begin), end\_(end), cutoff\_(cutoff) \{\}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127   flat\_range(flat\_range\& rhs, tbb::split) : begin\_(rhs.begin\_), end\_(rhs.begin\_ += rhs.size() / 2), cutoff\_(rhs.cutoff\_) \{\}}
\DoxyCodeLine{128 }
\DoxyCodeLine{129   flat\_iterator<Attrs...> begin() \{ \textcolor{keywordflow}{return} begin\_; \}}
\DoxyCodeLine{130   flat\_iterator<Attrs...> end() \{ \textcolor{keywordflow}{return} end\_; \}}
\DoxyCodeLine{131 }
\DoxyCodeLine{132   std::ptrdiff\_t size()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} end\_ -\/ begin\_; \}}
\DoxyCodeLine{133   \textcolor{keywordtype}{bool}           empty()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} begin\_ == end\_; \}}
\DoxyCodeLine{134   \textcolor{keywordtype}{bool}           is\_divisible()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} size() >= cutoff\_; \}}
\DoxyCodeLine{135 \};}
\DoxyCodeLine{136 }
\DoxyCodeLine{138 \textcolor{keyword}{template} <std::size\_t... Attrs>}
\DoxyCodeLine{139 \textcolor{keyword}{class }const\_flat\_range \{}
\DoxyCodeLine{140   const\_flat\_iterator<Attrs...> begin\_;}
\DoxyCodeLine{141   const\_flat\_iterator<Attrs...> end\_;}
\DoxyCodeLine{142   std::ptrdiff\_t                cutoff\_;}
\DoxyCodeLine{143 }
\DoxyCodeLine{144 \textcolor{keyword}{public}:}
\DoxyCodeLine{145   const\_flat\_range(const\_flat\_iterator<Attrs...> begin, const\_flat\_iterator<Attrs...> end, std::ptrdiff\_t cutoff)}
\DoxyCodeLine{146       : begin\_(begin), end\_(end), cutoff\_(cutoff) \{\}}
\DoxyCodeLine{147 }
\DoxyCodeLine{148   const\_flat\_range(const\_flat\_range\& rhs, tbb::split) : begin\_(rhs.begin\_), end\_(rhs.begin\_ += rhs.size() / 2), cutoff\_(rhs.cutoff\_) \{\}}
\DoxyCodeLine{149 }
\DoxyCodeLine{150   const\_flat\_iterator<Attrs...> begin() \{ \textcolor{keywordflow}{return} begin\_; \}}
\DoxyCodeLine{151   const\_flat\_iterator<Attrs...> end() \{ \textcolor{keywordflow}{return} end\_; \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153   std::ptrdiff\_t size()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} end\_ -\/ begin\_; \}}
\DoxyCodeLine{154   \textcolor{keywordtype}{bool}           empty()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} begin\_ == end\_; \}}
\DoxyCodeLine{155   \textcolor{keywordtype}{bool}           is\_divisible()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} size() >= cutoff\_; \}}
\DoxyCodeLine{156 \};}
\DoxyCodeLine{157 }
\DoxyCodeLine{159 \textcolor{keyword}{template} <std::size\_t... Attrs>}
\DoxyCodeLine{160 flat\_range<Attrs...> edges(std::ptrdiff\_t cutoff = std::numeric\_limits<std::ptrdiff\_t>::max()) \{}
\DoxyCodeLine{161   flat\_iterator<Attrs...> begin = \{source(), to\_be\_indexed\_.begin(), indices\_.begin(), size(), 0, 0\};}
\DoxyCodeLine{162   flat\_iterator<Attrs...> end   = \{source(), to\_be\_indexed\_.begin(),       indices\_.begin(),}
\DoxyCodeLine{163                                  size(),   index\_t(indices\_.size() -\/ 1), index\_t(to\_be\_indexed\_.size())\};}
\DoxyCodeLine{164   \textcolor{keywordflow}{return} \{begin, end, cutoff\};}
\DoxyCodeLine{165 \}}
\DoxyCodeLine{166 }
\DoxyCodeLine{167 \textcolor{keyword}{template} <std::size\_t... Attrs>}
\DoxyCodeLine{168 const\_flat\_range<Attrs...> edges(std::ptrdiff\_t cutoff = std::numeric\_limits<std::ptrdiff\_t>::max())\textcolor{keyword}{ const }\{}
\DoxyCodeLine{169   const\_flat\_iterator<Attrs...> begin = \{source(), to\_be\_indexed\_.begin(), indices\_.begin(), size(), 0, 0\};}
\DoxyCodeLine{170   const\_flat\_iterator<Attrs...> end   = \{source(), to\_be\_indexed\_.begin(),       indices\_.begin(),}
\DoxyCodeLine{171                                        size(),   index\_t(indices\_.size() -\/ 1), index\_t(to\_be\_indexed\_.size())\};}
\DoxyCodeLine{172   \textcolor{keywordflow}{return} \{begin, end, cutoff\};}
\DoxyCodeLine{173 \}}
\DoxyCodeLine{174 }
\DoxyCodeLine{175 \textcolor{preprocessor}{\#endif }}
\DoxyCodeLine{176 }
\DoxyCodeLine{177 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// NW\_GRAPH\_FLATTENED\_HPP}}
\DoxyCodeLine{178 }

\end{DoxyCode}
