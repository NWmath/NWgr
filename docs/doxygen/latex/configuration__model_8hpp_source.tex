\hypertarget{configuration__model_8hpp_source}{}\doxysection{configuration\+\_\+model.\+hpp}
\label{configuration__model_8hpp_source}\index{/Users/lums/NWmath/NWgr/include/nwgraph/generators/configuration\_model.hpp@{/Users/lums/NWmath/NWgr/include/nwgraph/generators/configuration\_model.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//}}
\DoxyCodeLine{2 \textcolor{comment}{// This file is part of NWHypergraph}}
\DoxyCodeLine{3 \textcolor{comment}{// (c) Pacific Northwest National Laboratory 2021-\/2021}}
\DoxyCodeLine{4 \textcolor{comment}{//}}
\DoxyCodeLine{5 \textcolor{comment}{// Licensed under Creative Commons Attribution-\/NonCommercial-\/ShareAlike 4.0 International License}}
\DoxyCodeLine{6 \textcolor{comment}{// https://creativecommons.org/licenses/by-\/nc-\/sa/4.0/}}
\DoxyCodeLine{7 \textcolor{comment}{//}}
\DoxyCodeLine{8 \textcolor{comment}{// Author: Xu Tony Liu}}
\DoxyCodeLine{9 \textcolor{comment}{//}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <edge\_list.hpp>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <execution>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <random>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{keyword}{namespace }nw \{}
\DoxyCodeLine{19 \textcolor{keyword}{namespace }hypergraph \{}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{comment}{/* }}
\DoxyCodeLine{22 \textcolor{comment}{* dist\_min -\/ Minimum value of distribution.  }}
\DoxyCodeLine{23 \textcolor{comment}{* dist\_max -\/ Maximum value of distribution.}}
\DoxyCodeLine{24 \textcolor{comment}{*/}}
\DoxyCodeLine{25 std::size\_t power\_gen (\textcolor{keywordtype}{double} dist\_min, \textcolor{keywordtype}{double} dist\_max) \{}
\DoxyCodeLine{26   \textcolor{comment}{/* Inverse square.  */}}
\DoxyCodeLine{27   \textcolor{keywordtype}{double} exponent = -\/2;}
\DoxyCodeLine{28 }
\DoxyCodeLine{29   \textcolor{keywordtype}{double} min\_pow = pow (dist\_min, exponent + 1);}
\DoxyCodeLine{30   \textcolor{keywordtype}{double} max\_pow = pow (dist\_max, exponent + 1);}
\DoxyCodeLine{31 }
\DoxyCodeLine{32   \textcolor{keywordflow}{return} (std::size\_t) pow((max\_pow -\/ min\_pow) * drand48 ()}
\DoxyCodeLine{33                       + min\_pow, 1 / (exponent + 1));}
\DoxyCodeLine{34 \}}
\DoxyCodeLine{35 \textcolor{keyword}{static} \textcolor{keywordtype}{double} standard\_exponential\_unlikely(bitgen\_t *bitgen\_state,}
\DoxyCodeLine{36                                                 uint8\_t idx, \textcolor{keywordtype}{double} x) \{}
\DoxyCodeLine{37   \textcolor{keywordflow}{if} (idx == 0) \{}
\DoxyCodeLine{38     \textcolor{comment}{/* Switch to 1.0 -\/ U to avoid log(0.0), see GH 13361 */}}
\DoxyCodeLine{39     \textcolor{keywordflow}{return} ziggurat\_exp\_r -\/ log(1.0 -\/ next\_double(bitgen\_state));}
\DoxyCodeLine{40   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((fe\_double[idx -\/ 1] -\/ fe\_double[idx]) * next\_double(bitgen\_state) +}
\DoxyCodeLine{41                  fe\_double[idx] <}
\DoxyCodeLine{42              exp(-\/x)) \{}
\DoxyCodeLine{43     \textcolor{keywordflow}{return} x;}
\DoxyCodeLine{44   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{45     \textcolor{keywordflow}{return} random\_standard\_exponential(bitgen\_state);}
\DoxyCodeLine{46   \}}
\DoxyCodeLine{47 \}}
\DoxyCodeLine{48 \textcolor{keywordtype}{double} random\_standard\_exponential(bitgen\_t *bitgen\_state) \{}
\DoxyCodeLine{49   uint64\_t ri;}
\DoxyCodeLine{50   uint8\_t idx;}
\DoxyCodeLine{51   \textcolor{keywordtype}{double} x;}
\DoxyCodeLine{52   ri = next\_uint64(bitgen\_state);}
\DoxyCodeLine{53   ri >>= 3;}
\DoxyCodeLine{54   idx = ri \& 0xFF;}
\DoxyCodeLine{55   ri >>= 8;}
\DoxyCodeLine{56   x = ri * we\_double[idx];}
\DoxyCodeLine{57   \textcolor{keywordflow}{if} (ri < ke\_double[idx]) \{}
\DoxyCodeLine{58     \textcolor{keywordflow}{return} x; \textcolor{comment}{/* 98.9\% of the time we return here 1st try */}}
\DoxyCodeLine{59   \}}
\DoxyCodeLine{60   \textcolor{keywordflow}{return} standard\_exponential\_unlikely(bitgen\_state, idx, x);}
\DoxyCodeLine{61 \}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63 \textcolor{keywordtype}{double} random\_power(bitgen\_t *bitgen\_state, \textcolor{keywordtype}{double} a) \{}
\DoxyCodeLine{64   \textcolor{keywordflow}{return} pow(1 -\/ exp(-\/random\_standard\_exponential(bitgen\_state)), 1. / a);}
\DoxyCodeLine{65 \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 std::vector<std::size\_t> power\_law\_gen(\textcolor{keywordtype}{double} std::size\_t samples)}
\DoxyCodeLine{68 \textcolor{comment}{/*}}
\DoxyCodeLine{69 \textcolor{comment}{* Return a random undirected bipartite graph (in edge\_list) from two given degree sequences.}}
\DoxyCodeLine{70 \textcolor{comment}{* The bipartite graph is composed of two partitions. }}
\DoxyCodeLine{71 \textcolor{comment}{* By default, contiguous\_id\_space is false, set A has nodes 0 to}}
\DoxyCodeLine{72 \textcolor{comment}{* (deg\_seqa.size() -\/ 1) and set B has nodes 0 to (deg\_seqb.size() -\/ 1).}}
\DoxyCodeLine{73 \textcolor{comment}{* When contiguous\_id\_space is true, set A has nodes 0 to (deg\_seqa.size() -\/ 1)}}
\DoxyCodeLine{74 \textcolor{comment}{* and set B has nodes deg\_seqa.size() to (deg\_seqa.size() + deg\_seqb.size() -\/ 1).}}
\DoxyCodeLine{75 \textcolor{comment}{* Nodes from set A are connected to nodes in set B by choosing}}
\DoxyCodeLine{76 \textcolor{comment}{* randomly from the possible free stubs, one in A and one in B.}}
\DoxyCodeLine{77 \textcolor{comment}{* Note directed graph is not supported in configuration model.}}
\DoxyCodeLine{78 \textcolor{comment}{* }}
\DoxyCodeLine{79 \textcolor{comment}{*/}}
\DoxyCodeLine{80 \textcolor{keyword}{template}<\textcolor{keyword}{class} T>}
\DoxyCodeLine{81 \mbox{\hyperlink{classnw_1_1graph_1_1index__edge__list}{nw::graph::edge\_list<nw::graph::undirected>}} }
\DoxyCodeLine{82 configuration\_model(std::vector<T>\& deg\_seqa, std::vector<T>\& deg\_seqb, \textcolor{keywordtype}{bool} contiguous\_id\_space = \textcolor{keyword}{false}) \{}
\DoxyCodeLine{83     \textcolor{comment}{//validate degree sequences such that their summation are equivalent}}
\DoxyCodeLine{84     \mbox{\hyperlink{classnw_1_1graph_1_1index__edge__list}{nw::graph::edge\_list<nw::graph::undirected>}} el;}
\DoxyCodeLine{85     T suma = std::reduce(std::execution::par\_unseq, deg\_seqa.cbegin(), deg\_seqa.cend());}
\DoxyCodeLine{86     T sumb = std::reduce(std::execution::par\_unseq, deg\_seqb.cbegin(), deg\_seqb.cend());}
\DoxyCodeLine{87     \textcolor{keywordflow}{if} (suma != sumb) \{}
\DoxyCodeLine{88         std::cout << \textcolor{stringliteral}{"{}Invalid degree sequences, sum(deg\_seqa)!=sum(deg\_seqb)"{}} << std::endl;}
\DoxyCodeLine{89         \textcolor{keywordflow}{return} el;}
\DoxyCodeLine{90     \}}
\DoxyCodeLine{91     \textcolor{keyword}{auto} populate\_stubs = [\&](\textcolor{keyword}{auto}\& degree\_sequence) -\/> std::vector<T> \{}
\DoxyCodeLine{92         std::vector<T> stubs(suma);}
\DoxyCodeLine{93         std::size\_t cursor = 0;}
\DoxyCodeLine{94         \textcolor{keywordflow}{for} (std::size\_t v = 0, e = degree\_sequence.size(); v < e; ++v) \{}
\DoxyCodeLine{95             \textcolor{keyword}{auto} degree\_v = degree\_sequence[v];}
\DoxyCodeLine{96             \textcolor{keyword}{auto} begin = stubs.begin() + cursor;}
\DoxyCodeLine{97             cursor += degree\_v;}
\DoxyCodeLine{98             \textcolor{keyword}{auto} end = begin + cursor;}
\DoxyCodeLine{99             std::fill(std::execution::par\_unseq, begin, end, v);}
\DoxyCodeLine{100         \}}
\DoxyCodeLine{101         \textcolor{keywordflow}{return} stubs;}
\DoxyCodeLine{102     \};}
\DoxyCodeLine{103     \textcolor{keyword}{auto} astubs = populate\_stubs(deg\_seqa);}
\DoxyCodeLine{104     \textcolor{keyword}{auto} bstubs = populate\_stubs(deg\_seqb);}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     std::random\_device rd;}
\DoxyCodeLine{107     std::mt19937 g(rd());}
\DoxyCodeLine{108 }
\DoxyCodeLine{109     std::shuffle(astubs.begin(), astubs.end(), g);}
\DoxyCodeLine{110     std::shuffle(bstubs.begin(), bstubs.end(), g);}
\DoxyCodeLine{111 }
\DoxyCodeLine{112     std::copy(astubs.begin(), astubs.end(), std::ostream\_iterator<int>(std::cout, \textcolor{stringliteral}{"{} "{}}));}
\DoxyCodeLine{113 }
\DoxyCodeLine{114 }
\DoxyCodeLine{115     el.open\_for\_push\_back();}
\DoxyCodeLine{116     \textcolor{keywordflow}{for}(std::size\_t i = 0, e = astubs.size(); i < e; ++i) \{}
\DoxyCodeLine{117         el.push\_back(astubs[i], bstubs[i]);}
\DoxyCodeLine{118     \}}
\DoxyCodeLine{119     el.close\_for\_push\_back();}
\DoxyCodeLine{120     \textcolor{keywordflow}{return} el;}
\DoxyCodeLine{121 \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123 \}\textcolor{comment}{//namespace hypergraph}}
\DoxyCodeLine{124 \}\textcolor{comment}{//namespace nw}}

\end{DoxyCode}
