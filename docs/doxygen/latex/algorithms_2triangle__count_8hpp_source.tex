\hypertarget{algorithms_2triangle__count_8hpp_source}{}\doxysection{triangle\+\_\+count.\+hpp}
\label{algorithms_2triangle__count_8hpp_source}\index{/Users/lums/NWmath/NWgr/include/nwgraph/algorithms/triangle\_count.hpp@{/Users/lums/NWmath/NWgr/include/nwgraph/algorithms/triangle\_count.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// }}
\DoxyCodeLine{2 \textcolor{comment}{// This file is part of NW Graph (aka GraphPack) }}
\DoxyCodeLine{3 \textcolor{comment}{// (c) Pacific Northwest National Laboratory 2018-\/2021 }}
\DoxyCodeLine{4 \textcolor{comment}{// (c) University of Washington 2018-\/2021 }}
\DoxyCodeLine{5 \textcolor{comment}{// }}
\DoxyCodeLine{6 \textcolor{comment}{// Licensed under terms of include LICENSE file }}
\DoxyCodeLine{7 \textcolor{comment}{// }}
\DoxyCodeLine{8 \textcolor{comment}{// Authors: }}
\DoxyCodeLine{9 \textcolor{comment}{//     Andrew Lumsdaine }}
\DoxyCodeLine{10 \textcolor{comment}{//     Kevin Deweese    }}
\DoxyCodeLine{11 \textcolor{comment}{//}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#ifndef NW\_GRAPH\_TRIANGLE\_COUNT\_HPP}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#define NW\_GRAPH\_TRIANGLE\_COUNT\_HPP}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}nwgraph/graph\_concepts.hpp"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}nwgraph/adaptors/cyclic\_range\_adapter.hpp"{}}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include "{}nwgraph/adaptors/neighbor\_range.hpp"{}}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include "{}nwgraph/adaptors/edge\_range.hpp"{}}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include "{}nwgraph/util/intersection\_size.hpp"{}}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include "{}nwgraph/util/parallel\_for.hpp"{}}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include "{}nwgraph/util/timer.hpp"{}}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}nwgraph/util/util.hpp"{}}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include <atomic>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include <future>}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include <tuple>}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{keyword}{namespace }nw \{}
\DoxyCodeLine{32 \textcolor{keyword}{namespace }graph \{}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{keyword}{template} <adjacency\_list\_graph GraphT>}
\DoxyCodeLine{35 \textcolor{keywordtype}{size\_t} triangle\_count\_v0(\textcolor{keyword}{const} GraphT\& A) \{}
\DoxyCodeLine{36   \textcolor{keywordtype}{size\_t} triangles = 0;}
\DoxyCodeLine{37   \textcolor{keyword}{auto}   first     = A.begin();}
\DoxyCodeLine{38   \textcolor{keyword}{auto}   last      = A.end();}
\DoxyCodeLine{39   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} u\_neighors = first; u\_neighors != last; ++u\_neighors) \{}
\DoxyCodeLine{40     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} elt = (*u\_neighors).begin(); elt != (*u\_neighors).end(); ++elt) \{}
\DoxyCodeLine{41       \textcolor{keyword}{auto} v = target(A, *elt);}
\DoxyCodeLine{42       triangles += nw::graph::intersection\_size(*u\_neighors, A[v]);}
\DoxyCodeLine{43     \}}
\DoxyCodeLine{44   \}}
\DoxyCodeLine{45   \textcolor{keywordflow}{return} triangles;}
\DoxyCodeLine{46 \}}
\DoxyCodeLine{47 }
\DoxyCodeLine{60 \textcolor{keyword}{template} <\textcolor{keyword}{class} Op>}
\DoxyCodeLine{61 std::size\_t triangle\_count\_async(std::size\_t threads, Op\&\& op) \{}
\DoxyCodeLine{62   \textcolor{comment}{// Launch the workers.}}
\DoxyCodeLine{63   std::vector<std::future<size\_t>> futures(threads);}
\DoxyCodeLine{64   \textcolor{keywordflow}{for} (std::size\_t tid = 0; tid < threads; ++tid) \{}
\DoxyCodeLine{65     futures[tid] = std::async(std::launch::async, op, tid);}
\DoxyCodeLine{66   \}}
\DoxyCodeLine{67 }
\DoxyCodeLine{68   \textcolor{comment}{// Reduce the outcome.}}
\DoxyCodeLine{69   \textcolor{keywordtype}{int}         i         = 0;}
\DoxyCodeLine{70   std::size\_t triangles = 0;}
\DoxyCodeLine{71   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& f : futures) \{}
\DoxyCodeLine{72     triangles += f.get();}
\DoxyCodeLine{73   \}}
\DoxyCodeLine{74   \textcolor{keywordflow}{return} triangles;}
\DoxyCodeLine{75 \}}
\DoxyCodeLine{89 \textcolor{keyword}{template} <\textcolor{keyword}{typename} RandomAccessIterator>}
\DoxyCodeLine{90 [[gnu::noinline]] std::size\_t triangle\_count\_v4(RandomAccessIterator first, RandomAccessIterator last, std::size\_t threads = 1) \{}
\DoxyCodeLine{91   \textcolor{keywordflow}{return} triangle\_count\_async(threads, [\&](std::size\_t tid) \{}
\DoxyCodeLine{92     std::size\_t triangles = 0;}
\DoxyCodeLine{93     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = first + tid; i < last; i += threads) \{}
\DoxyCodeLine{94       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} j = (*i).begin(), end = (*i).end(); j != end; ++j) \{}
\DoxyCodeLine{95         \textcolor{comment}{// assert(j < end);}}
\DoxyCodeLine{96         triangles += nw::graph::intersection\_size(j, end, first[std::get<0>(*j)]);}
\DoxyCodeLine{97       \}}
\DoxyCodeLine{98     \}}
\DoxyCodeLine{99     \textcolor{keywordflow}{return} triangles;}
\DoxyCodeLine{100   \});}
\DoxyCodeLine{101 \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{103 \textcolor{keyword}{template} <adjacency\_list\_graph Graph>}
\DoxyCodeLine{104 [[gnu::noinline]] std::size\_t triangle\_count\_v4a(\textcolor{keyword}{const} Graph\& G, std::size\_t threads = 1) \{}
\DoxyCodeLine{105   \textcolor{keyword}{auto} first = G.begin();}
\DoxyCodeLine{106   \textcolor{keyword}{auto} last = G.end();}
\DoxyCodeLine{107   \textcolor{keywordflow}{return} triangle\_count\_async(threads, [\&](std::size\_t tid) \{}
\DoxyCodeLine{108     std::size\_t triangles = 0;}
\DoxyCodeLine{109     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = first + tid; i < last; i += threads) \{}
\DoxyCodeLine{110       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} j = (*i).begin(), end = (*i).end(); j != end; ++j) \{}
\DoxyCodeLine{111         \textcolor{comment}{// assert(j < end);}}
\DoxyCodeLine{112         triangles += nw::graph::intersection\_size(j, end, first[target(G, *j)]);}
\DoxyCodeLine{113       \}}
\DoxyCodeLine{114     \}}
\DoxyCodeLine{115     \textcolor{keywordflow}{return} triangles;}
\DoxyCodeLine{116   \});}
\DoxyCodeLine{117 \}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 \}    \textcolor{comment}{// namespace graph}}
\DoxyCodeLine{120 \}    \textcolor{comment}{// namespace nw}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122 \textcolor{preprocessor}{\#endif    }\textcolor{comment}{//  NW\_GRAPH\_TRIANGLE\_COUNT\_HPP}}

\end{DoxyCode}
